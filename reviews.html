<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>All Reviews | Smoky Mountain Retrievers</title>
  <meta name="description" content="Browse every story from our Smoky Mountain Retrievers families." />

  <link rel="icon" href="assets/images/smokymountainretrieverslogo-96x91.png" type="image/png" />

  <!-- Bootstrap 5 (you already ship this locally, so keep local) -->
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />

  <!-- Optional: If you want Inter Tight like Mobirise -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,.08);
      --card-border: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --brand: #7dd3fc;         /* light blue accent */
      --brand-2: #a78bfa;       /* purple accent */
      --star: #fbbf24;          /* amber */
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }

    body{
      font-family: "Inter Tight", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(125, 211, 252,.24), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, rgba(167, 139, 250,.22), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(34, 211, 238,.10), transparent 60%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Navbar */
    .site-nav{
      backdrop-filter: blur(12px);
      background: rgba(11,18,32,.55);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .brand-lockup{
      display:flex; align-items:center; gap:.75rem;
      text-decoration:none;
    }
    .brand-lockup img{ width: 40px; height:auto; }
    .brand-lockup span{
      font-weight: 800;
      letter-spacing: .2px;
      color: var(--text);
    }
    .nav-link{
      color: var(--muted) !important;
      font-weight: 600;
    }
    .nav-link:hover{ color: var(--text) !important; }

    /* Page header */
    .page-hero{
      padding: 3.2rem 0 1.6rem;
    }
    .hero-card{
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      padding: 2rem;
    }
    .hero-title{
      font-size: clamp(2rem, 2.6vw + 1rem, 3.2rem);
      line-height: 1.05;
      letter-spacing: -.6px;
      margin: 0;
      font-weight: 900;
    }
    .hero-sub{
      margin-top: .75rem;
      margin-bottom: 0;
      color: var(--muted);
      font-size: 1.05rem;
    }

    /* Controls */
    .controls{
      display:flex;
      flex-wrap: wrap;
      gap: .75rem;
      justify-content: space-between;
      align-items: end;
      margin-top: 1.25rem;
    }
    .control{
      min-width: 240px;
      max-width: 420px;
      flex: 1 1 240px;
    }
    .form-label{
      color: var(--muted);
      font-weight: 700;
      margin-bottom: .35rem;
    }
    .form-select, .form-control{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      border-radius: 14px;
      padding: .65rem .85rem;
    }
    .form-select:focus, .form-control:focus{
      outline: none;
      box-shadow: 0 0 0 .2rem rgba(125,211,252,.15);
      border-color: rgba(125,211,252,.35);
    }

    /* Grid of cards */
    .reviews-wrap{
      padding: 1rem 0 3.5rem;
    }
    .reviews-grid{
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1rem;
      margin-top: 1.25rem;
    }
    .review-card{
      grid-column: span 4;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding: 1.2rem 1.2rem 1.1rem;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      transition: transform .15s ease, border-color .15s ease;
      height: 100%;
    }
    .review-card:hover{
      transform: translateY(-2px);
      border-color: rgba(125,211,252,.22);
    }
    .review-message{
      color: var(--text);
      font-size: 1.02rem;
      line-height: 1.5;
      margin: 0 0 .9rem;
      white-space: pre-wrap; /* preserve user line breaks */
    }

    .review-meta{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: .75rem;
      margin-top: .4rem;
    }
    .review-name{
      margin: 0;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .2px;
      font-size: .98rem;
    }

    /* Stars: SVG so they never “go invisible” due to missing glyphs */
    .stars{
      display:flex;
      align-items:center;
      gap: .18rem;
      flex-shrink: 0;
    }
    .star{
      width: 18px;
      height: 18px;
      display:block;
      color: rgba(251,191,36,.28); /* empty star */
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.35));
    }
    .star.filled{
      color: var(--star);
    }

    .status{
      margin-top: 1.5rem;
      color: var(--muted);
      text-align:center;
      font-weight: 600;
    }

    /* Responsive */
    @media (max-width: 991.98px){
      .review-card{ grid-column: span 6; }
    }
    @media (max-width: 575.98px){
      .hero-card{ padding: 1.5rem; }
      .review-card{ grid-column: span 12; }
    }

    /* Footer */
    footer{
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(11,18,32,.55);
      backdrop-filter: blur(10px);
    }
    footer a{ color: var(--text); font-weight: 700; text-decoration: none; }
    footer a:hover{ text-decoration: underline; }
  </style>
</head>

<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg site-nav sticky-top">
    <div class="container py-2">
      <a class="brand-lockup" href="index.html">
        <img src="assets/images/smokymountainretrieverslogo-96x91.png" alt="Smoky Mountain Retrievers logo">
        <span>Smoky Mountain Retrievers</span>
      </a>

      <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-end" id="navMain">
        <ul class="navbar-nav align-items-lg-center gap-lg-2 mt-3 mt-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html#people04-1i">Testimonials</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="review.html">Leave a Review</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="page-hero">
    <div class="container">
      <div class="hero-card">
        <div class="d-flex flex-column gap-2">
          <h1 class="hero-title">All Reviews</h1>
          <p class="hero-sub">Browse every story from our Smoky Mountain Retrievers families.</p>
        </div>

        <div class="controls">
          <div class="control">
            <label class="form-label" for="reviews-sort">Sort by stars</label>
            <select class="form-select" id="reviews-sort">
              <option value="high" selected>Highest to lowest</option>
              <option value="low">Lowest to highest</option>
            </select>
          </div>

          <div class="control">
            <label class="form-label" for="reviews-search">Search</label>
            <input class="form-control" id="reviews-search" type="search" placeholder="Search names or keywords…" autocomplete="off" />
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- REVIEWS -->
  <main class="reviews-wrap">
    <div class="container">
      <div id="status" class="status">Loading reviews…</div>
      <div id="reviews-grid" class="reviews-grid" aria-live="polite"></div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4">
    <div class="container text-center">
      <a href="index.html#people04-1i">Back to Testimonials</a>
    </div>
  </footer>

  <script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>

  <script>
    const grid = document.getElementById("reviews-grid");
    const statusEl = document.getElementById("status");
    const sortEl = document.getElementById("reviews-sort");
    const searchEl = document.getElementById("reviews-search");

    let cachedReviews = [];

    function normalizeReviews(payload) {
      if (Array.isArray(payload)) return payload;
      if (payload && Array.isArray(payload.reviews)) return payload.reviews;
      return [];
    }

    function parseRating(value) {
      if (typeof value === "number" && !Number.isNaN(value)) return value;
      if (typeof value === "string") {
        const match = value.match(/[\d.]+/);
        return match ? Number(match[0]) : 0;
      }
      return 0;
    }

    function clampRating(r) {
      const n = Number(r);
      if (Number.isNaN(n)) return 0;
      return Math.max(0, Math.min(5, n));
    }

    function sortReviews(reviews, direction) {
      return [...reviews].sort((a, b) => {
        const ra = parseRating(a.rating);
        const rb = parseRating(b.rating);
        return direction === "low" ? ra - rb : rb - ra;
      });
    }

    function matchesSearch(review, q) {
      if (!q) return true;
      const name = (review.name || "").toLowerCase();
      const msg = (review.message || "").toLowerCase();
      return name.includes(q) || msg.includes(q);
    }

    function makeStarSVG(filled) {
      const svgNS = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("viewBox", "0 0 24 24");
      svg.setAttribute("class", "star" + (filled ? " filled" : ""));
      svg.setAttribute("aria-hidden", "true");

      const path = document.createElementNS(svgNS, "path");
      path.setAttribute("fill", "currentColor");
      path.setAttribute("d",
        "M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
      );

      svg.appendChild(path);
      return svg;
    }

    function renderStars(rating) {
      const r = clampRating(rating);
      const filledCount = Math.round(r); // visually consistent; change to Math.floor if you prefer
      const wrap = document.createElement("div");
      wrap.className = "stars";
      wrap.setAttribute("role", "img");
      wrap.setAttribute("aria-label", `${r} out of 5 stars`);

      for (let i = 1; i <= 5; i++) {
        wrap.appendChild(makeStarSVG(i <= filledCount));
      }
      return wrap;
    }

    function clearGrid() {
      while (grid.firstChild) grid.removeChild(grid.firstChild);
    }

    function renderReviews(reviews) {
      clearGrid();

      if (!reviews.length) {
        statusEl.textContent = "No reviews found.";
        return;
      }

      statusEl.textContent = `${reviews.length} review${reviews.length === 1 ? "" : "s"}`;

      for (const review of reviews) {
        const name = review.name || "Happy Customer";
        const message = review.message || "";
        const ratingValue = clampRating(parseRating(review.rating));

        const card = document.createElement("article");
        card.className = "review-card";

        const msgP = document.createElement("p");
        msgP.className = "review-message";
        msgP.textContent = message;

        const meta = document.createElement("div");
        meta.className = "review-meta";

        const nameEl = document.createElement("p");
        nameEl.className = "review-name";
        nameEl.textContent = name;

        const starsEl = renderStars(ratingValue);

        card.appendChild(msgP);
        meta.appendChild(nameEl);
        meta.appendChild(starsEl);
        card.appendChild(meta);

        grid.appendChild(card);
      }
    }

    function updateView() {
      const direction = sortEl ? sortEl.value : "high";
      const q = (searchEl?.value || "").trim().toLowerCase();

      const filtered = cachedReviews.filter(r => matchesSearch(r, q));
      const sorted = sortReviews(filtered, direction);

      renderReviews(sorted);
    }

    async function loadReviews() {
      statusEl.textContent = "Loading reviews…";
      clearGrid();

      try {
        const response = await fetch("/reviews", { headers: { "Accept": "application/json" } });
        if (!response.ok) throw new Error("Failed to load reviews.");

        const payload = await response.json();
        cachedReviews = normalizeReviews(payload);

        updateView();
      } catch (err) {
        statusEl.textContent = "Reviews are unavailable right now. Please check back soon.";
      }
    }

    sortEl?.addEventListener("change", updateView);
    searchEl?.addEventListener("input", () => {
      // tiny debounce to avoid re-rendering on every keystroke burst
      window.clearTimeout(searchEl._t);
      searchEl._t = window.setTimeout(updateView, 80);
    });

    loadReviews();
  </script>
</body>
</html>
